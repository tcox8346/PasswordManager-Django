{% extends "base.html" %}

{% block title %} {{user.username}} Friends Credentials  {% endblock title %}
{% block Body %}
        <!--Code Goes HERE  Markup-->

    {% block Shared_credentials_block %}

    <i class="fas fa-h3    ">  Friend Credentials</i>
    <!--Display Each Records Details  -->
        {% for record in friend_credentials %}
            <!--Display Record Details of shared credentials for multiple users in friends list -->
            <div id= '{{record.id}}' >
            <!--Display Record Details of shared credentials owner, username, and password of credentials -->
                <ul class="list-group list-group-horizontal">
                    <li class="list-group-item"><i class="fas fa-h2    ">{{record.owner}} </i></li>
                    <li class="list-group-item"><i class="fas fa-h2    ">{{record.username}} </i></li>
                    <li class="list-group-item"><i class="fas fa-h2    ">{{record.password}} </i></li>
                </ul>
            </div>        
        {% endfor %}
        <br>
    {% endblock Shared_credentials_block %}



    {% block scripts %}
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script>
        <script >
        //Document Assignment
            /// PROJECT NOTE - Currently CSRFTOKEN is exempt - fix before release(properly pass csrf token in header)
            // Setup Code 
                // JavaScript function to get cookie by name; retrieved from https://docs.djangoproject.com/en/3.1/ref/csrf/
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');
                // Reload document when any ajax call completes


            // On Document Ready Populate 
            $(document).ready(function(){
                // For each element meant to act as a accept request button 
                $(".accept_btn_request").each(function(){
                    // add accept functionality

                    $(this).click(function(){

                        let instance_id = $(this).parent().parent().parent().attr('id')
                        console.log(`Accept button clicked ID: ${instance_id}`);
                        var view_url = $(this).attr('data-view')
                        console.log(`Accept button clicked URL: ${view_url}`);
                        //accept_request_friend(view_url, csrf_instance);
                        $.ajax({
                            url: view_url, 
                            type: "POST",
                            headers: 
                                {
                                "X-Requested-With": "XMLHttpRequest",
                                'X-CSRFToken': csrftoken,
                                mode: 'same-origin'
                                },
                            data: {  'purpose': 'accept_request', 'request_id': instance_id, 'user_response':'1', 'user_instance': '{{user}}'},
                            dataType: 'json',
                            success: function () {
                                console.log("done");
                            }
                        });
                    });
                });

                // For each element meant to act as a decline request button 
                $(".decline_btn_request").each(function(){
                    // add Decline functionality

                    $(this).click(function(){

                        let instance_id = $(this).parent().parent().parent().attr('id')
                        console.log(`Decline button clicked ID: ${instance_id}`);
                        var view_url = $(this).attr('data-view');
                        console.log(`Decline button clicked URL: ${view_url}`);
                        console.log(`body values to be passed:: ${instance_id} ,  {{user}}`);
                        //accept_request_friend(view_url, csrf_instance);

                        $.ajax({
                            url: view_url, 
                            type: "POST",
                            headers: 
                                {
                                "X-Requested-With": "XMLHttpRequest",
                                'X-CSRFToken': csrftoken,
                                mode: 'same-origin'
                                },
                            data: {  'purpose': 'accept_request', 'request_id': instance_id, 'user_response':'0', 'user_instance': '{{user}}'},
                            dataType: 'json',
                            success: function () {
                                console.log("done");
                            }
                        });
                        
                    });

                    
                });
                // For each element meant to act as a cancel request button 
                $(".cancel_btn_request").each(function(){
                    // add Cancel functionality

                    $(this).click(function(){

                        let instance_id = $(this).parent().parent().parent().attr('id')
                        console.log(`Decline button clicked ID: ${instance_id}`);
                        var view_url = $(this).attr('data-view');
                        console.log(`Decline button clicked URL: ${view_url}`);                       
                        $.ajax({
                            url: view_url, 
                            type: "POST",
                            headers: 
                                {
                                "X-Requested-With": "XMLHttpRequest",
                                'X-CSRFToken': csrftoken,
                                mode: 'same-origin'
                                },
                            data: {  'purpose': 'cancel_request', 'request_id': instance_id, 'user_response':'None', 'user_instance': '{{user}}'},
                            dataType: 'json',
                            success: function () {
                                console.log("done");
                            }
                        });
                        
                    });
                })
                    
            });

            </script> 
    {% endblock scripts %}
{% endblock Body %}

{% block Foot %}

{% endblock Foot %}

